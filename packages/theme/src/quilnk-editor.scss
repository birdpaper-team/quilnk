@use "mixins/mixins.scss" as *;

// A4 尺寸: 210mm x 297mm (桌面端)
@include b("editor") {
  // 舞台: 居中纸张
  &__stage {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10mm; // 页面间距
    
    // 移动端适配
    @media (max-width: 768px) {
      padding: 10mm 0;
      gap: 10mm;
    }
  }

  // 纸张容器
  &__paper {
    width: 210mm;
    height: 297mm;
    border-radius: 1px;
    position: relative;
    flex-shrink: 0; // 防止页面被压缩
    
    // 更真实的纸张阴影 - 更淡更自然
    box-shadow:
      0 0 0 1px rgba(0, 0, 0, 0.02),
      0 1px 2px rgba(0, 0, 0, 0.04),
      0 2px 4px rgba(0, 0, 0, 0.03),
      0 4px 12px rgba(0, 0, 0, 0.02),
      0 8px 24px rgba(0, 0, 0, 0.015);
    
    background:
      /* 真实纸张的纤维纹理 */
      radial-gradient(0.8px 0.8px at 12% 18%, rgba(0,0,0,0.01) 0, rgba(0,0,0,0) 100%),
      radial-gradient(1px 1px at 88% 82%, rgba(0,0,0,0.008) 0, rgba(0,0,0,0) 100%),
      radial-gradient(1.2px 1.2px at 35% 65%, rgba(0,0,0,0.006) 0, rgba(0,0,0,0) 100%),
      radial-gradient(0.9px 0.9px at 75% 25%, rgba(0,0,0,0.005) 0, rgba(0,0,0,0) 100%),
      /* 纸张基色 - 纯白色 */
      #ffffff;
    
    overflow: hidden;
    
    // 移动端自适应
    @media (max-width: 768px) {
      width: 100vw;
      min-height: 100vh;
      height: auto;
      border-radius: 0;
      margin: 0;
    }
    
    // 移动端去除阴影
    @media (max-width: 768px) {
      box-shadow: none;
    }
    
    // 纸张边缘效果
    &::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 1px;
      border: 0.3px solid rgba(0,0,0,0.06);
      pointer-events: none;
    }
    
    // 纸张内部微光
    &::after {
      content: "";
      position: absolute;
      inset: 0.5px;
      border-radius: 0.5px;
      background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%);
      pointer-events: none;
    }
  }

  // 页边距
  &__page {
    --page-margin: 10mm;
    --line-height: 8mm; // 增加行高让横线更高
    --baseline-offset: 2mm; // 调整基线偏移
    --line-margin: 15mm; // 横线左右边距
    --line-vertical-margin: 20mm; // 横线上下边距
    height: 100%;
    padding: var(--page-margin);
    box-sizing: border-box;
    position: relative;
    
    // 移动端边距调整
    @media (max-width: 768px) {
      --page-margin: 15px;
      --line-margin: 20px; // 使用px单位，更适合移动端
      --line-vertical-margin: 20px;
      padding: var(--page-margin);
      min-height: 100vh; // 确保移动端有最小高度
    }
    
    // 使用伪元素创建带边距的横线
    &::before {
      content: '';
      position: absolute;
      top: var(--line-vertical-margin);
      left: var(--line-margin);
      right: var(--line-margin);
      bottom: var(--line-vertical-margin);
      background:
        repeating-linear-gradient(
          to bottom,
          transparent 0mm,
          transparent calc(var(--line-height) - 0.2mm),
          rgba(108, 139, 181, 0.45) calc(var(--line-height) - 0.1mm),
          rgba(108, 139, 181, 0.35) var(--line-height)
        );
      pointer-events: none;
    }
  }

  // 内容区域 (可编辑)
  &__content {
    position: absolute;
    top: var(--line-vertical-margin);
    left: var(--line-margin);
    right: var(--line-margin);
    bottom: var(--line-vertical-margin);
    outline: none;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: var(--line-height);
    color: #2c2c2c;
    word-break: break-word;
    caret-color: #1f6fff;
    overflow: hidden; // 防止内容溢出到横线区域外
    
    // 关键：让文字基线精确对齐横线底部
    display: block;
    padding: 0;
    
    // 移动端样式调整
    @media (max-width: 768px) {
      font-size: 14px;
      overflow-y: auto; // 允许滚动
      -webkit-overflow-scrolling: touch; // iOS 平滑滚动
      min-height: calc(100vh - 40px); // 确保有足够的高度
      bottom: auto; // 让高度自适应
    }

    // 确保br标签的高度与行高一致
    br {
      display: block;
      margin: 0;
      line-height: var(--line-height);
      height: var(--line-height);
    }

    p { 
      margin: 0;
      padding: 0;
      line-height: var(--line-height);
      min-height: var(--line-height);
      // 使用 flexbox 确保文字基线对齐
      display: flex;
      align-items: flex-end; // 让文字底部对齐
      
      &:not(:last-child) {
        margin-bottom: 0;
      }
      
      // 空段落也要占据行高
      &:empty {
        min-height: var(--line-height);
      }
    }
    
    // 标题保持行对齐
    h1, h2, h3, h4, h5, h6 { 
      line-height: var(--line-height);
      margin: 0;
      padding: 0;
      font-weight: 600;
      min-height: var(--line-height);
      display: flex;
      align-items: flex-end;
    }
    h3 { font-size: 16px; }
    
    ul, ol { 
      padding-left: 20px; 
      margin: 0;
      
      li {
        line-height: var(--line-height);
        margin: 0;
        padding: 0;
        min-height: var(--line-height);
        display: flex;
        align-items: flex-end;
      }
    }
    
    blockquote {
      border-left: 2px solid #8aa9d3;
      margin: 0;
      padding-left: 12px;
      color: #5a5a5a;
      background: rgba(138, 169, 211, 0.03);
      line-height: var(--line-height);
      min-height: var(--line-height);
      display: flex;
      align-items: flex-end;
    }
    
    a { 
      color: #1f6fff; 
      text-decoration: underline;
      text-decoration-thickness: 0.5px;
    }
    
    img { 
      max-width: 100%; 
      border-radius: 2px; 
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      margin: 0;
      display: block;
    }

    // 占位符样式
    &:empty::before {
      content: attr(data-placeholder);
      color: #a8a8a8;
      line-height: var(--line-height);
      font-style: italic;
      display: flex;
      align-items: flex-end;
      min-height: var(--line-height);
    }
    
    // 确保焦点时保持对齐
    &:focus {
      outline: none;
    }
    
    // 处理 contenteditable 的默认行为
    div {
      line-height: var(--line-height);
      min-height: var(--line-height);
      display: flex;
      align-items: flex-end;
      margin: 0;
      padding: 0;
    }
  }

  // 小屏幕适配
  @media (max-width: 900px) {
    &__stage { padding: 16px 0 60px; }
  }
  
  // 移动端全局优化
  @media (max-width: 768px) {
    // 防止横向滚动
    &__stage {
      overflow-x: hidden;
    }
    
    // 优化触摸体验
    &__content {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: text;
      user-select: text;
    }
    
    // 移动端字体大小调整
    &__content {
      h1 { font-size: 18px; }
      h2 { font-size: 16px; }
      h3 { font-size: 14px; }
    }
  }
  
  // 超小屏幕适配
  @media (max-width: 480px) {
    &__page {
      --page-margin: 10px;
      --line-margin: 15px; // 使用px单位
      --line-vertical-margin: 15px;
    }
    
    &__content {
      font-size: 13px;
    }
  }

  // 页面头部
  &__page-header {
    position: absolute;
    top: -30px;
    left: 0;
    right: 0;
    height: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px;
    opacity: 0;
    transition: opacity 0.2s ease;
    
    // 鼠标悬停时显示
    .quilnk-editor__paper:hover & {
      opacity: 1;
    }
    
    // 移动端始终显示
    @media (max-width: 768px) {
      opacity: 1;
      position: static;
      height: 40px;
      background: rgba(0, 0, 0, 0.05);
      margin-bottom: 10px;
    }
  }

  // 页面编号
  &__page-number {
    font-size: 12px;
    color: #666;
    font-weight: 500;
    
    @media (max-width: 768px) {
      font-size: 14px;
    }
  }

  // 删除按钮
  &__delete-btn {
    width: 20px;
    height: 20px;
    border: none;
    background: #ff4444;
    color: white;
    border-radius: 50%;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    
    &:hover {
      background: #cc0000;
      transform: scale(1.1);
    }
    
    &:active {
      transform: scale(0.95);
    }
    
    @media (max-width: 768px) {
      width: 24px;
      height: 24px;
      font-size: 16px;
    }
  }

  // 添加页面区域
  &__add-page {
    display: flex;
    justify-content: center;
    
    @media (max-width: 768px) {
      margin-top: 10mm;
    }
  }
}
