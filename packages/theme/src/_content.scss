@use "mixins/mixins.scss" as *;

// 内容区域样式
@include b("editor") {
  // 内容区域 (可编辑)
  &__content {
    position: absolute;
    top: var(--line-vertical-margin);
    left: var(--line-margin);
    right: var(--line-margin);
    bottom: calc(var(--line-vertical-margin) + var(--page-number-height));
    outline: none;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: var(--line-height);
    color: #2c2c2c;
    word-break: break-word;
    caret-color: #1f6fff;
    overflow: hidden; // 防止内容溢出到横线区域外
    
    // 关键：让文字基线精确对齐横线底部
    display: block;
    padding: 0;
    
    // 移动端样式调整
    @media (max-width: 768px) {
      font-size: 14px;
      overflow-y: auto; // 允许滚动
      -webkit-overflow-scrolling: touch; // iOS 平滑滚动
      min-height: calc(100vh - 40px); // 确保有足够的高度
      bottom: auto; // 让高度自适应
    }

    // 确保br标签的高度与行高一致
    br {
      display: block;
      margin: 0;
      line-height: var(--line-height);
      height: var(--line-height);
    }

    p { 
      margin: 0;
      padding: 0;
      line-height: var(--line-height);
      min-height: var(--line-height);
      // 移除 flex 布局，使用 block 布局以便 text-align 生效
      display: block;
      
      &:not(:last-child) {
        margin-bottom: 0;
      }
      
      // 空段落也要占据行高
      &:empty {
        min-height: var(--line-height);
      }
      
      // 对齐样式
      &[align="left"], &[style*="text-align:left"], &[style*="text-align: left"] {
        text-align: left;
      }
      
      &[align="center"], &[style*="text-align:center"], &[style*="text-align: center"] {
        text-align: center;
      }
      
      &[align="right"], &[style*="text-align:right"], &[style*="text-align: right"] {
        text-align: right;
      }
      
      &[align="justify"], &[style*="text-align:justify"], &[style*="text-align: justify"] {
        text-align: justify;
      }
    }
    
    // 标题保持行对齐
    h1, h2, h3, h4, h5, h6 { 
      line-height: var(--line-height);
      margin: 0;
      padding: 0;
      font-weight: 600;
      min-height: var(--line-height);
      display: block;
      
      // 对齐样式
      &[align="left"], &[style*="text-align:left"], &[style*="text-align: left"] {
        text-align: left;
      }
      
      &[align="center"], &[style*="text-align:center"], &[style*="text-align: center"] {
        text-align: center;
      }
      
      &[align="right"], &[style*="text-align:right"], &[style*="text-align: right"] {
        text-align: right;
      }
      
      &[align="justify"], &[style*="text-align:justify"], &[style*="text-align: justify"] {
        text-align: justify;
      }
    }
    h3 { font-size: 16px; }
    
    // 移除列表样式，因为不再支持列表功能
    ul, ol {
      // 重置列表样式
      list-style: none;
      padding: 0;
      margin: 0;
      
      li {
        // 重置列表项样式
        list-style: none;
        padding: 0;
        margin: 0;
        display: block;
      }
    }
    
    blockquote { 
      border-left: 2px solid #8aa9d3;
      margin: 0;
      padding-left: 12px;
      color: #5a5a5a;
      background: rgba(138, 169, 211, 0.03);
      line-height: var(--line-height);
      min-height: var(--line-height);
      display: block;
      
      // 对齐样式
      &[align="left"], &[style*="text-align:left"], &[style*="text-align: left"] {
        text-align: left;
      }
      
      &[align="center"], &[style*="text-align:center"], &[style*="text-align: center"] {
        text-align: center;
      }
      
      &[align="right"], &[style*="text-align:right"], &[style*="text-align: right"] {
        text-align: right;
      }
      
      &[align="justify"], &[style*="text-align:justify"], &[style*="text-align: justify"] {
        text-align: justify;
      }
    }
    
    a { 
      color: #1f6fff; 
      text-decoration: underline;
      text-decoration-thickness: 0.5px;
    }
    
    img { 
      max-width: 100%; 
      border-radius: 2px; 
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      margin: 0;
      display: block;
    }

    // 占位符样式
    &:empty::before {
      content: attr(data-placeholder);
      color: #a8a8a8;
      line-height: var(--line-height);
      font-style: italic;
      display: flex;
      align-items: flex-end;
      min-height: var(--line-height);
    }
    
    // 确保焦点时保持对齐
    &:focus {
      outline: none;
    }
    
    // 处理 contenteditable 的默认行为
    div {
      line-height: var(--line-height);
      min-height: var(--line-height);
      display: block;
      margin: 0;
      padding: 0;
      
      // 对齐样式
      &[align="left"], &[style*="text-align:left"], &[style*="text-align: left"] {
        text-align: left;
      }
      
      &[align="center"], &[style*="text-align:center"], &[style*="text-align: center"] {
        text-align: center;
      }
      
      &[align="right"], &[style*="text-align:right"], &[style*="text-align: right"] {
        text-align: right;
      }
      
      &[align="justify"], &[style*="text-align:justify"], &[style*="text-align: justify"] {
        text-align: justify;
      }
    }
    
    // 确保所有元素都支持对齐样式
    * {
      &[align="left"], &[style*="text-align:left"], &[style*="text-align: left"] {
        text-align: left;
      }
      
      &[align="center"], &[style*="text-align:center"], &[style*="text-align: center"] {
        text-align: center;
      }
      
      &[align="right"], &[style*="text-align:right"], &[style*="text-align: right"] {
        text-align: right;
      }
      
      &[align="justify"], &[style*="text-align:justify"], &[style*="text-align: justify"] {
        text-align: justify;
      }
    }
  }

  // 移动端全局优化 - 内容相关
  @media (max-width: 768px) {
    // 优化触摸体验
    &__content {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: text;
      user-select: text;
    }
    
    // 移动端字体大小调整
    &__content {
      h1 { font-size: 18px; }
      h2 { font-size: 16px; }
      h3 { font-size: 14px; }
    }
  }

  // 超小屏幕适配 - 内容相关
  @media (max-width: 480px) {
    &__content {
      font-size: 13px;
    }
  }
}